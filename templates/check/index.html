{%extends 'check/base.html'%}


{% block index %}



{% for pr in products %}
  {{pr.name}}
  <img src="{{pr.pic.url}}" alt="" style = "width:50px;">
  {{pr.added_at}}
  {{pr.category}}

  <div data-product_id = "{{pr.id}}" data-action = "add" class = "btn btn-primary btn-lg"> </div>
<hr>
<br>
{%endfor%}

<input type="text" value="12" class = "data_to_send">


<script type="text/javascript" defer>



var allBtns = document.querySelectorAll(".btn")

for (let i = 0; i < allBtns.length; i++)
{
  allBtns[i].addEventListener("click", function (e)
  {
      var product_id = this.dataset.product_id
      var action = this.dataset.action

      if(user=="AnonymousUser")
      {
        console.log("User Not Logged In")
      }
      else
      {
        updateUserOrder(product_id, action)
      }
    })
  }


function updateUserOrder(product_id, action)
{
  var url = "/api/change_cart"

  fetch( url ,
    {
      method:"POST",
      headers:
      {
        'Content-type':"application/json",
        "X-CSRFToken": csrftoken
      },

      body: JSON.stringify(
      {
        "product_id":product_id,
        "action" : action,

      })
    })

    .then((resp) => {
      return resp.json();
    })

    .then((response) =>{
      console.log("total_quantity: ", response  )
      document.querySelector(".amount").textContent = response.total_quantity
      })
}


</script>

{% endblock %}












<!--
    // $.ajax(
    //   {
    //     // url:"/ProductApi/change_cart",
    //     url: "/api/change_cart",
    //     type: "get",
    //
    //     data: {
    //       "product_id":product_id,
    //        "action":action ,
    //        csrfmiddlewaretoken: '{{ csrf_token }}'
    //       },
    //     success: async function (response)
    //     {
    //       document.querySelector(".amount").textContent = response.total_quantity
    //     }
    //   }) -->
